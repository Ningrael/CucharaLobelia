<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Misiones – @cucharalobelia</title>
  <!-- React 18 + Babel (sin build) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>html,body{margin:0;height:100%;background:#3b2b20}</style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useRef, useState, useEffect, useMemo } = React;

    const POOLS = [
      { items: ["Domination", "Capture & Control", "Breakthrough", "Stake a Claim"]},
      { items: ["To the Death!", "Lords of Battle", "Assassination", "Contest of Champions"]},
      { items: ["Hold Ground", "Heirloom of Ages Past", "Sites of Power", "Command the Battlefield"]},
      { items: ["Destroy the Supplies", "Retrieval", "Seize the Prizes", "Treasure Hoard"]},
      { items: ["Reconnoitre", "Storm the Camp", "Divide & Conquer", "Escort the Wounded"]},
      { items: ["Fog of War", "Clash by Moonlight", "Lead from the Front", "Convergence"]},
    ];

    function App(){
      const [selected, setSelected] = useState("");
      const allMissions = useMemo(() => POOLS.flatMap(p => p.items || []), []);
      const [rounds, setRounds] = useState("3");
      const screenRef = useRef(null);
      const bannerRef = useRef(null);
      const controlsRef = useRef(null);
      const footerRef = useRef(null);
      const gridRef = useRef(null);

      const [badges, setBadges] = useState({});

      const recalcSizes = () => {
        const screen = screenRef.current; if (!screen) return;
        const bannerH   = (bannerRef.current   && bannerRef.current.getBoundingClientRect().height) || 0;
        const controlsH = (controlsRef.current && controlsRef.current.getBoundingClientRect().height) || 0;
        const footerH   = (footerRef.current   && footerRef.current.getBoundingClientRect().height) || 0;

        let availH = screen.clientHeight - bannerH - controlsH - footerH - 8;
        let availW = screen.clientWidth - 8*2;

        const gap = 5;
        const cols = 2, rows = 3;
        const sizeByH = Math.floor((availH - gap * (rows + 1)) / rows);
        const sizeByW = Math.floor((availW - gap * (cols + 1)) / cols);
        const tile = Math.max(0, Math.min(sizeByH, sizeByW));

        const pad = 5;
        const innerW = tile - pad*2;
        const innerH = tile - pad*2;
        const btnGap = 6;
        const subCols = 2, subRows = 2;
        const btnW = Math.max(0, Math.floor((innerW - btnGap * (subCols - 1)) / subCols));
        const btnH = Math.max(0, Math.floor((innerH - btnGap * (subRows - 1)) / subRows));

        const rootStyle = gridRef.current && gridRef.current.style; if (!rootStyle) return;
        rootStyle.setProperty("--tile", `${tile}px`);
        rootStyle.setProperty("--btnW", `${btnW}px`);
        rootStyle.setProperty("--btnH", `${btnH}px`);
        rootStyle.setProperty("--gap", `${gap}px`);
      };

      useEffect(()=>{
        recalcSizes();
        const onR = () => recalcSizes();
        window.addEventListener('resize', onR);
        return ()=> window.removeEventListener('resize', onR);
      },[]);

      const pickRandom = () => {
        if (!allMissions.length) return;
        setBadges({});
        const name = allMissions[Math.floor(Math.random()*allMissions.length)];
        setSelected(name);
      };

      const clampRounds = (v) => {
        let n = parseInt(v||"3",10); if(Number.isNaN(n)) n=3; n = Math.max(1, Math.min(6, n)); return String(n);
      };

      const generateRounds = () => {
        const n = parseInt(clampRounds(rounds),10);
        const idxs = Array.from({length: POOLS.length}, (_,i)=>i);
        for(let i=idxs.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [idxs[i], idxs[j]] = [idxs[j], idxs[i]]; }
        const chosen = idxs.slice(0, n);
        const b = {};
        let last = null;
        chosen.forEach((pi, k)=>{
          const pool = POOLS[pi];
          const items = pool.items||[]; if (!items.length) return;
          const m = items[Math.floor(Math.random()*items.length)];
          b[m] = k+1;
          last = m;
        });
        setBadges(b);
        if (last) setSelected(last);
      };

      const dec = () => { let n = parseInt(rounds||"3",10); if(Number.isNaN(n)) n=3; if(n>1) setRounds(String(n-1)); };
      const inc = () => { let n = parseInt(rounds||"3",10); if(Number.isNaN(n)) n=3; if(n<6) setRounds(String(n+1)); };

      const handleMissionClick = (name) => {
        const fileName = name.toUpperCase().replace(/ /g, "_") + ".pdf";
        const url = encodeURI(`./${fileName}`);
        fetch(url, { method: 'HEAD' }).then(res => {
          if(res.ok){
            window.open(url, "_blank");
          } else {
            alert("Función en construcción");
          }
        }).catch(()=> alert("Función en construcción"));
      };

      return (
        <div className="stage" style={{minHeight:"100svh",display:"flex",alignItems:"center",justifyContent:"center",background:"#3b2b20"}}>
          <style>{`
            :root{
              --cream:#EFE5CF; --cream-2:#F7EFDA;
              --ink:#221b14; --ink-soft:#574635;
              --gold:#CFA15B; --gold-2:#EAD39A; --gold-line:#B79045;
              --shadow-lg:0 14px 40px rgba(0,0,0,.40);
              --shadow-sm:0 4px 14px rgba(0,0,0,.18);
              --tile:120px; --btnW:54px; --btnH:54px; --gap:6px;
              --radius:14px; --radius-pill:9999px;
            }
            *{box-sizing:border-box}

            .phone{aspect-ratio:9/16; width:min(96vw,480px); max-height:min(98vh,940px); border-radius:22px; padding:6px; box-shadow:var(--shadow-lg); background:#3b2b20; border:1px solid rgba(0,0,0,.45); position:relative}  
            .screen{position:absolute; inset:8px; border-radius:18px; overflow:hidden; display:flex; flex-direction:column; background:transparent;} 
            .screen::before{content:""; position:absolute; inset:0; background:url('../Inicio.png') center/cover no-repeat; z-index:0}
            .screen > *{position:relative; z-index:1}  

            .banner{padding:6px 8px; border-bottom:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.18); display:flex; align-items:center} 
            .brand{font-family:Georgia,serif; font-weight:900; color:var(--cream); font-size:16px; letter-spacing:.3px; text-shadow:0 1px 0 rgba(0,0,0,.35)}

            .controls{padding:6px 8px; display:flex; align-items:center; justify-content:space-between; gap:8px; background:rgba(0,0,0,.12); border-bottom:1px solid rgba(255,255,255,.10)}  

            .btn-gold,.btn-secondary{appearance:none; border:1px solid var(--gold-line); border-radius:var(--radius-pill); color:var(--ink);
              padding:6px 12px; font-weight:800; cursor:pointer; transition:transform .06s ease, filter .18s ease, box-shadow .18s ease;
              box-shadow:var(--shadow-sm)}
            .btn-sm{padding:5px 10px} 

            .btn-gold{background:linear-gradient(180deg,var(--gold-2),var(--gold));}
            .btn-secondary{background:linear-gradient(180deg, #f0e7cf, #e2d7bb); color:var(--ink)}
            .btn-gold:active,.btn-secondary:active{transform:translateY(1px) scale(.99)}
            @media(hover:hover){ .btn-gold:hover,.btn-secondary:hover{filter:brightness(1.05)} }

            .stack{display:flex; align-items:center; gap:6px}
            .rounds-group{display:flex; align-items:center; gap:8px; padding:6px; border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.10); border-radius:9999px}
            .rounds-label{color:#f4e9d2; font-weight:900; margin:0 4px}
            .stepper{display:flex; align-items:center; gap:6px} 
            .btn-circle{width:24px;height:24px;border-radius:var(--radius-pill);display:inline-flex;align-items:center;justify-content:center;
              border:1px solid var(--gold-line); background:linear-gradient(180deg,var(--gold-2),var(--gold)); color:var(--ink); font-weight:900; box-shadow:var(--shadow-sm)}
            .rounds-input{appearance:none;-moz-appearance:textfield;width:40px;padding:4px 6px;border-radius:10px;border:1px solid rgba(255,255,255,.25);
              background:rgba(0,0,0,.28);color:var(--cream);font-weight:800;text-align:center}

            .content{flex:1; overflow:hidden}
            .pools{height:100%; padding:var(--gap) 4px} 
            .pools-grid{height:100%; display:grid; grid-template-columns:repeat(2, var(--tile)); grid-template-rows:repeat(3, var(--tile)); gap:var(--gap); justify-content:center} 

            .pool-card{width:var(--tile); height:var(--tile);
              background:linear-gradient(180deg,var(--cream),var(--cream-2));
              border:1px solid rgba(0,0,0,.12); border-radius:var(--radius); padding:6px; box-shadow:var(--shadow-sm); display:flex; flex-direction:column}

            .missions{list-style:none; padding:0; margin:0; flex:1; display:grid; grid-template-columns:repeat(2, 1fr); grid-template-rows:repeat(2, 1fr); gap:6px; align-items:stretch; justify-items:stretch}
            .missions>li{min-width:0; min-height:0; position:relative}

            .item{width:100%; height:100%; border:1px solid rgba(0,0,0,.12); border-radius:10px;
              background:#fff8e9; display:flex; align-items:center; justify-content:center; padding:4px; text-align:center;
              box-shadow:inset 0 -1px 0 rgba(0,0,0,.05), 0 1px 0 rgba(255,255,255,.6); transition:filter .15s ease, transform .06s ease}
            .item:active{transform:translateY(1px)}
            @media(hover:hover){ .item:hover{filter:brightness(1.03)} }
            .item .label{font-weight:700; font-size:11px; color:var(--ink); line-height:1.2; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden}
            .item.selected{outline:2px solid var(--gold); outline-offset:1px; box-shadow:0 0 10px rgba(202,161,91,.28)}
            .badge{position:absolute; right:4px; top:4px; padding:2px 5px; border-radius:9999px; background:rgba(12,11,9,.82); border:1px solid rgba(234,211,154,.6); color:#f2e6c6; font-size:9px; font-weight:800}

            .footer{padding:8px; text-align:center; background:rgba(0,0,0,.12); border-top:1px solid rgba(255,255,255,.10)} 
            .btn-footer{border-radius:var(--radius-pill); border:1px solid rgba(0,0,0,.15); background:var(--cream); color:#1c1a16; padding:8px 14px; font-weight:700; box-shadow:var(--shadow-sm)}
          `}</style>

          <div className="phone">
            <div className="screen" ref={screenRef}>
              <div className="banner" ref={bannerRef}>
                <div className="brand">@cucharalobelia Misiones</div>
              </div>

              <div className="controls" ref={controlsRef}>
                <button className="btn-gold" onClick={pickRandom}>Elegir Random</button>
                <div className="rounds-group" role="group" aria-label="Rondas y generar">
                  <span className="rounds-label">Rondas</span>
                  <div className="stepper">
                    <button className="btn-circle" onClick={dec} aria-label="Quitar ronda">-</button>
                    <input className="rounds-input" type="text" inputMode="numeric" value={rounds}
                      onChange={(e)=>{ const v=e.target.value.trim(); if (v===""){setRounds("");return;} if (/^[1-6]$/.test(v)){setRounds(v);} }}
                      onBlur={()=>{ if (rounds === "") setRounds("3"); }} aria-live="polite" aria-label="Número de rondas" />
                    <button className="btn-circle" onClick={inc} aria-label="Agregar ronda">+</button>
                  </div>
                  <button className="btn-secondary btn-sm" onClick={generateRounds}>Generar</button>
                </div>
              </div>

              <div className="content">
                <div className="pools">
                  <div className="pools-grid" ref={gridRef}>
                    {POOLS.map((pool, pi)=> (
                      <section key={pi} className="pool-card">
                        <ul className="missions">
                          {pool.items.map((name)=> (
                            <li key={name}>
                              <button className={"item" + (selected===name?" selected":"")} onClick={()=> handleMissionClick(name)}><span className="label">{name}</span>{badges[name]? <span className="badge">R{badges[name]}</span>: null}</button>
                            </li>
                          ))}
                        </ul>
                      </section>
                    ))}
                  </div>
                </div>
              </div>

              <div className="footer" ref={footerRef}>
                <button className="btn-footer" onClick={()=> window.location.href = "../index.html"}>Volver</button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
